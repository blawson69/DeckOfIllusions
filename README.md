# DeckOfIllusions

This [Roll20](http://roll20.net/) script automates use of the Deck of Illusions wondrous item for D&D 5e games. By default it contains all 34 cards, but the deck can be configured to have randomly lost 1d20-1 cards (per the SRD rules) if the deck has been found amongst treasure. Each time a card is drawn and used, that card is removed from the deck. The deck may then be reset and used (found) again if desired.

## Dealing a Card

Using the "Deal Card" token action button from the Deck Character ([below](#deck-character-generation)) will randomly choose a card from the deck and display the name of the creature(s) for which an illusion is created. This also places a token representing the illusion generated by the card on top of the Deck Character token. If a card specifies multiple beings, those tokens will also be placed on the map. This card is then removed from the deck and cannot be redrawn until the deck is reset.

## Deck Character Generation
To give players access to a Deck of Illusions, you create a character representing the Deck that your player can drag onto the map where they wish to throw a card. As only one Deck can exist at a time, you can only generate one Deck Character.

To create a Deck Character, just drag a token you wish to represent a drawn card onto the VTT from your library. Give this token *the name of the character to whom the Deck belongs*. This name will be used in the dialog when dealing a card, and will be used to automatically assign control of the Deck character to the player(s) who controls this character. If a matching character is not found or that character is controlled by all players, control of the Deck character must be set manually. When the token is properly named and selected, click the "Create Deck Character" button in the Config menu. *Do not* rename the Deck character.

## Illusion Tokens
You can give the script tokens to use for each being that is generated by the Deck of Illusions. These Illusion Tokens will be placed on top of the Deck Character token on the VTT. If the card indicates more than one being, Illusion Tokens for those beings will be placed on the map around the main Token. These tokens are set to be controlled by the player or players who control the character that owns the Deck, so they can be moved according to the rules of the Deck.

The "View Illusions" button in the config menu shows all available Illusion Tokens, their names, and any token image you have already provided.

Creating an Illusion Token is simple:
- Drag a graphic to the VTT that represents the being for which you wish to create an Illusion Token. Resize this token accordingly for the size of the being.
- Make sure the "View Illusions" dialog is open with the list of beings.
- Select the token and click the "Set" button next to the being for which you are setting an Illusion Token.

If you have already created an Illusion Token for a being, creating it again will overwrite the existing one.

You can also export your Illusion Tokens into a handout for use in another game, and import tokens from another game into the current one. To export, simply click the "Export Illusions" button. This will create a handout named "DOI: Illusion Tokens" which can be copied via the Transmogrifier into another game. To import an existing "DOI: Illusion Tokens" handout, click the "Import Illusions" button. Importing into a game with any number of Illusion Tokens already set will overwrite those tokens with ones from the handout.

In accordance with Roll20's API rules ([https://wiki.roll20.net/API:Objects#imgsrc_and_avatar_property_restrictions](https://wiki.roll20.net/API:Objects#imgsrc_and_avatar_property_restrictions)), you can *only* use images that you have uploaded to your library. If you have purchased any through the Marketplace, you must first download them, then upload to your library.

## Found in Treasure

The SRD description of the Deck of Illusions says that 1d20-1 cards will be missing from Decks of Illusion found amongst a treasure horde. To accommodate this, click the "Found Deck" button in the config menu to randomly remove 1d20-1 cards from the deck. Don't worry, this will only work with a full deck. **GM only.**

## Deck Reset

The Deck of Illusions can be reset back to the original 34 cards in case a different deck is found by using the "Reset Deck" button in the config menu. Two decks cannot be used at once, however. **GM only.**

## Configuration

Send `!doi config` to chat to get a menu that tells how many cards remain in the Deck, lets you reset the Deck, provides buttons view/import/export the Illusion Tokens, and allows you to change the following options. **GM only.**

The SRD description of the Deck of Illusions suggests card equivalences with a standard deck of playing cards. The name of these playing card faces may be displayed along with the corresponding creature(s) name(s) if desired but will not be by default. Click the "Show" or "Hide" link to toggle the display on and off.

By default, the script will randomly rotate the Illusion Tokens to make their appearance more random. You may turn this off depending on what kind of tokens you use.  Click the "Turn Off" or "Turn On" link to toggle random rotation on and off.
